language: node_js
dist: xenial
node_js:
- 16.13.2
install:
- npm ci
cache:
  directories:
  - "~/.npm"
  - "~/.cache"
  npm: true
addons:
  sonarcloud: 
    organization: 'ibmrepositories'
    token: 
      secure: "RusWCKyhDypxVBgmxkJ4lOrVNW2iTtXaWquWibSIXHzHE5vgQI1skrMK/QVmuzydE5u2VXL2k3frU7eX2UiGC8l9vrXDyU361QtzRgJYmm4/ja0pMJsiVhpaayc3EB5H1hZBR1oknDhXLHYhmqh2sLaZPcSnSk4kZsW5rt0Hf4hqb8SQOYNVxMqW5XE67zoWIPB8CaH07WXIosUZZsfdKwJfgnJV7l1AmxbPQ555o32VIFxf+0JDqcrWZVeVtxsvn2zHRAeWjqhEjckwU/U/gkRJmS+/WFXzXRYbFLdu6o2yIP95Wb7ipL/RTxUtRtxGU1tMvqZM7ikTt77mQx3mVpg/ocvFBWP9/+qrJj02yjP1beY7FVJgwjI3DRTr5MZQeUcXiRUF0iGnBBXV6mCYcWfiCdmNLQvcL3m8khL5V+6BzLWW5ITiWLqWBOfgs9ZUXCFt4aPBJ1u2mIpQXdkA2s1fi1eoJRNPVcVd9gBd0Q0im30cWrEpu1k36OiExwHipOkODw2pip5DVE1zC7zDZ4e8VvklKNDOTbvnfGMkW9Sc+3V1kzn71YAUj8mZwMQvGMqlbN0doEtBZaMchF4R42Ic5Gri6qEnrXbrn87r1RK+95kZccM2Mglwu77DvglUXBnDoQmjY1cAx0829Ynnd3BVAokvpV+1O9EBQfNrH+0="
jobs:
  include:
  - stage: Run snyk test & monitor
    script:
    - snyk auth "${SNYK_AUTH_TOKEN}"
    - snyk test --dev
    after_success:
    - snyk monitor
  - stage: Run unit tests & sonar-scanner
    script:
    - npm run test:unit
    - sonar-scanner
  - stage: Run detect secrets
    script:
    - npm run detect-secrets $(git ls-files)
env:
  global:
    # SNKY
    secure: cwj7YDIKkfDF344cDoxxBln8Zilg7ohMFrU9BmX7Z0wnSAkS//GyyU81PW4yZKuB7/JpZ9YdoziLFbJCpnKqeNxlPzT6ySVV1/ebsjtZFqHqVeEyMklTiwzHt4D49i3RDoqZ7HF7RAnfKoxIUsEiH3UjwAkCqzbh5xZt6D8Qo5JMwXFgrc0q79BaeX9NjOVqFpmpCESRxZg88tK343Wi4iLtPL02C7vOmix8QujO9/7P16rfkzzTT6Az257CSpj4WGVKc6g72pgDcYDVZiRVRdjcUxk4YnESeSYb4d8g1a3HPFrso0v6tP0o33LR4drApxc/TDmZNMTO6VYlSe5daDXuUoq50EgFjJvI55JKPDa/jDiViiaIZLmudV0mamHE3HnVo4b2bNGY/j7uCPF4TEnnbxsl+6qE4i/DTF0dFSC9KeWH5YQiYIBk7KtoGpSBCCHeDMw6OvmZ+rhkjIUc+LXr3J0VbU4prfgJUQ6m5CzQ1DTdYfgxitYv/7/Z4K9Ap3lT3lHZOO6zF6E2GfMFZjPDpVslPIy1afYlzTnlAn1tV1BAPvg8AFLHqMIUK3FZIcQQQPYnMyMbjQgsnB1NYsxrncpdYYIDKLnywhhMoCgP0XrC7YO6TTx7HigCHW6GmDb0710mlmYJLGyB8QK1xQA7wwr/kVkkxDgWwRamNik=
